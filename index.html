<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Submit Feedback</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<style>
  body.dark-mode { background-color: #121212; color: #f5f5f5; }
  body.dark-mode .card { background-color: #1e1e1e; color: #f5f5f5; }
  .toast-container { position: fixed; top: 1rem; right: 1rem; z-index: 9999; }
</style>
</head>
<body class="bg-light">

<div class="container py-5">
  <div class="row justify-content-center">
    <div class="col-md-6">
      <div class="card shadow-lg rounded-4 border-0">
        <div class="card-body p-5">
          <h2 class="text-center mb-4">üí¨ Share Your Feedback</h2>
          <form id="feedbackForm">
            <div class="mb-3">
              <label class="form-label">Name</label>
              <input type="text" class="form-control" name="name" required>
            </div>
            <div class="mb-3">
              <label class="form-label">Email</label>
              <input type="email" class="form-control" name="email" required>
            </div>
            <div class="mb-3">
              <label class="form-label">Feedback</label>
              <textarea class="form-control" name="message" rows="4" required></textarea>
            </div>

            <div class="d-grid gap-2 mb-3">
              <button type="submit" class="btn btn-primary">Submit & Review</button>
              <a href="https://wa.me/919391021353?text=Hi! I want to contact you about the PG." target="_blank" class="btn btn-success">Message us on WhatsApp</a>
              <button type="button" id="toggleMode" class="btn btn-secondary">Toggle Light/Dark Mode</button>
              <button type="button" id="shareLink" class="btn btn-info">Share Link with Friends</button>
            </div>
          </form>

          <div id="responseMsg" class="text-center mt-3"></div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Toast Container -->
<div class="toast-container" id="toastContainer"></div>

<script>
const backendURL = "https://feedback-app-backend-q06f.onrender.com/feedback";
const googleReviewURL = "https://www.google.com/maps/place/SRI+BHAVYA+HOSTEL+(+LADIES)/@17.7359304,83.3334379,17z/data=!3m1!4b1!4m14!1m5!8m4!1e1!2s108712311622211703163!3m1!1e1!3m7!1s0x3a394357d7003749:0x7284e137601f4a6f!8m2!3d17.7359304!4d83.3360128!9m1!1b1!16s%2Fg%2F11c6vjqdq7?hl=en&entry=ttu&g_ep=EgoyMDI1MDgyNC4wIKXMDSoASAFQAw%3D%3D";

// Submit feedback
document.getElementById("feedbackForm").addEventListener("submit", async (e) => {
  e.preventDefault();
  
  const formData = {
    name: e.target.name.value,
    email: e.target.email.value,
    message: e.target.message.value
  };

  try {
    const res = await fetch(backendURL, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(formData)
    });

    if (res.ok) {
      e.target.reset();
      document.getElementById("responseMsg").innerHTML =
        `<div class="alert alert-success">‚úÖ Feedback submitted! Redirecting to Google review‚Ä¶</div>`;
      setTimeout(() => {
        window.open(googleReviewURL, "_blank");
      }, 1000);
    } else {
      document.getElementById("responseMsg").innerHTML =
        `<div class="alert alert-danger">‚ùå Something went wrong!</div>`;
    }
  } catch (err) {
    document.getElementById("responseMsg").innerHTML =
      `<div class="alert alert-danger">‚ö†Ô∏è Network Error!</div>`;
  }
});

// Toggle Light/Dark mode
document.getElementById("toggleMode").addEventListener("click", () => {
  document.body.classList.toggle("dark-mode");
});

// Share page link
document.getElementById("shareLink").addEventListener("click", () => {
  navigator.clipboard.writeText(window.location.href);
  alert("Link copied to clipboard!");
});

// Toast notifications
async function fetchRecentFeedback() {
  try {
    const res = await fetch(backendURL);
    if (!res.ok) return;
    const data = await res.json();
    if (data.length === 0) return;

    const latest = data[data.length - 1];
    showToast(`${latest.name || "Anonymous"} submitted a review: "${latest.message.slice(0, 30)}..."`);
  } catch(err) { console.log(err); }
}

// Create toast
function showToast(message) {
  const toast = document.createElement("div");
  toast.className = "toast align-items-center text-bg-primary border-0 mb-2";
  toast.setAttribute("role", "alert");
  toast.innerHTML = `<div class="d-flex">
    <div class="toast-body">${message}</div>
    <button type="button" class="btn-close btn-close-white me-2 m-auto" onclick="this.parentElement.parentElement.remove()"></button>
  </div>`;
  document.getElementById("toastContainer").appendChild(toast);

  // Auto remove after 5 seconds
  setTimeout(() => toast.remove(), 5000);
}

// Fetch every 2 minutes
setInterval(fetchRecentFeedback, 120000);
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>

